<!DOCTYPE html>
<html lang="fr">
<head>
  
    <title>Media Player :: Blog de SRID</title>
  
  <link rel="icon" type="image/x-icon" href="/favicon.ico">

</head>
<body>


<div class="container center">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Blog de SRID
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/posts">Articles</a></li>
        
      
        
          <li><a href="/about">À propos</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/posts" >Articles</a></li>
        
      
        
          <li><a href="/about" >À propos</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://greyrav.github.io/posts/media-player/">Media Player</a>
  </h1>
  <div class="post-meta"><time class="post-date">2024-12-12</time></div>

  
  


  

  <div class="post-content"><div>
        <p>Bonjour à tous et bienvenue sur mon blog concernant le Media Player. Le Media Player est un outil que je voulais concevoir afin de faire des projets d&rsquo;apprentissage.</p>
<h2 id="quel-est-son-but-">Quel est son but ?<a href="#quel-est-son-but-" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Son but est simplement de pouvoir changer de musique/vidéo, et mettre lecture/pause. On peut bien évidemment changer le code pour en faire totalement autre chose comme par exemple un mini stream deck ou autre.</p>
<h2 id="quels-sont-les-composants-principaux-">Quels sont les composants principaux ?<a href="#quels-sont-les-composants-principaux-" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Les composants/matériaux principaux sont tout simplement un écran SSD1315, un Arduino pro micro, et des boutons classiques (G-Switch GT-TC075B-H100-L1).</p>
<p>En ce qui concerne le code ci-dessous, celui-ci est fait en C++ avec le framework IDE PlatformIO et Arduino IDE, sur VS Code :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;Arduino.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;HID-Project.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;U8g2lib.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;Wire.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> PREV_BTN <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> PLAY_BTN <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> NEXT_BTN <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>U8G2_SSD1306_128X64_NONAME_F_HW_I2C <span style="color:#a6e22e">u8g2</span>(U8G2_R0);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Variables d&#39;état
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">bool</span> isPlaying <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>String currentAction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Ready&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> lastActionTime <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> ACTION_DISPLAY_TIME <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Variables pour l&#39;animation de la barre de progression
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> progressBarPosition <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> PROGRESS_BAR_WIDTH <span style="color:#f92672">=</span> <span style="color:#ae81ff">120</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> lastProgressUpdate <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> PROGRESS_UPDATE_INTERVAL <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Variables pour les effets de transition
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> transitionStep <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">bool</span> inTransition <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>String nextAction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span>() {
</span></span><span style="display:flex;"><span>  Wire.begin();
</span></span><span style="display:flex;"><span>  pinMode(PREV_BTN, INPUT_PULLUP);
</span></span><span style="display:flex;"><span>  pinMode(PLAY_BTN, INPUT_PULLUP);
</span></span><span style="display:flex;"><span>  pinMode(NEXT_BTN, INPUT_PULLUP);
</span></span><span style="display:flex;"><span>  Consumer.begin();
</span></span><span style="display:flex;"><span>  u8g2.begin();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">drawPlayTriangle</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y, <span style="color:#66d9ef">int</span> size) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> height <span style="color:#f92672">=</span> size <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.5</span>;
</span></span><span style="display:flex;"><span>  u8g2.drawTriangle(x, y, x <span style="color:#f92672">+</span> size, y <span style="color:#f92672">+</span> (height<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>), x, y <span style="color:#f92672">+</span> height);
</span></span><span style="display:flex;"><span>  u8g2.drawTriangle(x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, x <span style="color:#f92672">+</span> size<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, y <span style="color:#f92672">+</span> (height<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>), x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y <span style="color:#f92672">+</span> height<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">drawPauseIcon</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y, <span style="color:#66d9ef">int</span> width, <span style="color:#66d9ef">int</span> height) {
</span></span><span style="display:flex;"><span>  u8g2.drawBox(x, y, width, height);
</span></span><span style="display:flex;"><span>  u8g2.drawBox(x <span style="color:#f92672">+</span> width <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>, y, width, height);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">drawArrow</span>(<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y, <span style="color:#66d9ef">int</span> size, <span style="color:#66d9ef">bool</span> right) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (right) {
</span></span><span style="display:flex;"><span>    u8g2.drawLine(x, y, x <span style="color:#f92672">+</span> size, y <span style="color:#f92672">+</span> size<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>    u8g2.drawLine(x <span style="color:#f92672">+</span> size, y <span style="color:#f92672">+</span> size<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, x, y <span style="color:#f92672">+</span> size);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    u8g2.drawLine(x <span style="color:#f92672">+</span> size, y, x, y <span style="color:#f92672">+</span> size<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>    u8g2.drawLine(x, y <span style="color:#f92672">+</span> size<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, x <span style="color:#f92672">+</span> size, y <span style="color:#f92672">+</span> size);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">drawProgressBar</span>() {
</span></span><span style="display:flex;"><span>  u8g2.drawFrame(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">25</span>, PROGRESS_BAR_WIDTH, <span style="color:#ae81ff">6</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (isPlaying) {
</span></span><span style="display:flex;"><span>    u8g2.drawBox(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">25</span>, progressBarPosition, <span style="color:#ae81ff">6</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (millis() <span style="color:#f92672">-</span> lastProgressUpdate <span style="color:#f92672">&gt;</span> PROGRESS_UPDATE_INTERVAL) {
</span></span><span style="display:flex;"><span>      progressBarPosition<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (progressBarPosition <span style="color:#f92672">&gt;</span> PROGRESS_BAR_WIDTH) progressBarPosition <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      lastProgressUpdate <span style="color:#f92672">=</span> millis();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">drawMainScreen</span>(<span style="color:#66d9ef">bool</span> drawText <span style="color:#f92672">=</span> true) {
</span></span><span style="display:flex;"><span>  u8g2.clearBuffer();
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Cadre principal
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  u8g2.drawRFrame(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">128</span>, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>  u8g2.drawLine(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">128</span>, <span style="color:#ae81ff">16</span>);
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Titre
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  u8g2.setFont(u8g2_font_profont12_tr);
</span></span><span style="display:flex;"><span>  u8g2.drawStr(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">12</span>, <span style="color:#e6db74">&#34;Media Controller&#34;</span>);
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Barre de progression
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  drawProgressBar();
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Texte d&#39;état
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (drawText) {
</span></span><span style="display:flex;"><span>    u8g2.setFont(u8g2_font_profont11_tr);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> textWidth <span style="color:#f92672">=</span> u8g2.getStrWidth(currentAction.c_str());
</span></span><span style="display:flex;"><span>    u8g2.drawStr((<span style="color:#ae81ff">128</span><span style="color:#f92672">-</span>textWidth)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">40</span>, currentAction.c_str());
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Contrôles
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  drawArrow(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">12</span>, false);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (isPlaying) {
</span></span><span style="display:flex;"><span>    drawPauseIcon(<span style="color:#ae81ff">58</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">12</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    drawPlayTriangle(<span style="color:#ae81ff">58</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">12</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  drawArrow(<span style="color:#ae81ff">96</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">12</span>, true);
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  u8g2.sendBuffer();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setAction</span>(String action, <span style="color:#66d9ef">bool</span> temporary <span style="color:#f92672">=</span> false) {
</span></span><span style="display:flex;"><span>  currentAction <span style="color:#f92672">=</span> action;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (temporary) {
</span></span><span style="display:flex;"><span>    lastActionTime <span style="color:#f92672">=</span> millis();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  drawMainScreen();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loop</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Gestion des boutons
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (digitalRead(PREV_BTN) <span style="color:#f92672">==</span> LOW) {
</span></span><span style="display:flex;"><span>    Consumer.write(MEDIA_PREVIOUS);
</span></span><span style="display:flex;"><span>    setAction(<span style="color:#e6db74">&#34;Previous Track&#34;</span>, true);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#ae81ff">200</span>);
</span></span><span style="display:flex;"><span>    Consumer.releaseAll();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (digitalRead(PLAY_BTN) <span style="color:#f92672">==</span> LOW) {
</span></span><span style="display:flex;"><span>    Consumer.write(MEDIA_PLAY_PAUSE);
</span></span><span style="display:flex;"><span>    isPlaying <span style="color:#f92672">=</span> <span style="color:#f92672">!</span>isPlaying;
</span></span><span style="display:flex;"><span>    progressBarPosition <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    setAction(isPlaying <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;Playing&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Paused&#34;</span>);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#ae81ff">200</span>);
</span></span><span style="display:flex;"><span>    Consumer.releaseAll();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (digitalRead(NEXT_BTN) <span style="color:#f92672">==</span> LOW) {
</span></span><span style="display:flex;"><span>    Consumer.write(MEDIA_NEXT);
</span></span><span style="display:flex;"><span>    setAction(<span style="color:#e6db74">&#34;Next Track&#34;</span>, true);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#ae81ff">200</span>);
</span></span><span style="display:flex;"><span>    Consumer.releaseAll();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Retour à l&#39;état normal après le délai pour les actions temporaires
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (millis() <span style="color:#f92672">-</span> lastActionTime <span style="color:#f92672">&gt;</span> ACTION_DISPLAY_TIME <span style="color:#f92672">&amp;&amp;</span> 
</span></span><span style="display:flex;"><span>      (currentAction <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Previous Track&#34;</span> <span style="color:#f92672">||</span> currentAction <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Next Track&#34;</span>)) {
</span></span><span style="display:flex;"><span>    setAction(isPlaying <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;Playing&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Paused&#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Mise à jour normale de l&#39;écran
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  drawMainScreen();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Vous trouverez directement tout le projet sur GitHub <a href="https://github.com/GreyRav/media-player/tree/main">ICI</a>, avec tous les frameworks, librairies et autres.</p>
<p>Voici à quoi ressemble la PCB :</p>
<p><img src="/posts/media-player/image1.png" alt="PCB vue 1">
<img src="/posts/media-player/image2.png" alt="PCB vue 2"></p>
<p>Si vous voulez l&rsquo;acheter pour soutenir le projet ou alors vous amuser avec, vous la retrouverez sur mon site : <a href="https://openandhack.fr">Open &amp; Hack</a></p>
<p>Merci d&rsquo;avoir pris le temps de lire ce post !</p>

      </div></div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2024 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
